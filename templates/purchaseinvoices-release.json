{
  "_id": "{{@ system @}}-{{@ datatype @}}-share",
  "add_namespaces": false,
  "batch_size": 1,
  "compaction": {
    "keep_versions": 100
  },
  "exclude_completeness": [
    "{{@ system @}}-{{@ datatype @}}-share"
  ],
  "namespaced_identifiers": false,
  "sink": {
    "deletion_tracking": false,
    "set_initial_offset": "onload"
  },
  "source": {
    "dataset": "{{@ system @}}-purchaseinvoices-transform",
    "type": "dataset"
  },
  "transform": [
    {
      "rules": {
        "default": [
          [
            "filter",
            [
              "eq",
              "_S.status.id",
              "DRAFT"
            ]
          ],
          [
            "copy",
            "*"
          ]
        ]
      },
      "type": "dtl"
    },
    {
      "id_expression": "{{ id }}",
      "operation": "release",
      "properties": {
        "endpoint": "purchase_invoices"
      },
      "replace_entity": false,
      "system": "{{@ system @}}",
      "type": "rest"
    }
  ],
  "type": "pipe"
}